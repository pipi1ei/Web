<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  
  <script>
    const { log } = console

    // Generator 函数
    ;(function () {  
      log('---------------- generator start -------------------')

      const ob = {
        name: 'zs',
        sayName: function(){
          log(this.name)
        }
      }

      let say = ob.sayName;

      say()
      ob.sayName()


      function* test () {  
        yield "hello"
        yield "world"
        return "ending"
      }

      var t = test()
      log(t.next())
      log(t.next())
      log(t.next())
      log(t.next())

      function spawn(genF) {  
        return new Promise((resolve, reject) => {
          const gen = genF()
          function step(nextF) {  
            let next
            try{
              next = nextF()
            }catch(e){
              log(e)
            }

            if(next.done){
              return resolve(next.value)
            }

            Promise.resolve(next.value).then(v => {
              step(function(){return gen.next(v)})
            }, e => {
              step(function () {return gen.throw(e)})
            })
          }

          step(function(){
            return gen.next(undefined)
          })
        })
      }

      log('---------------- generator end ---------------------')
    }())
    
    // 观察者模式
    ;(function () { 
      const { log } = console 
      class Dep {
        constructor() {
          this.subs = new Set()
        }

        addSub(sub) {
          this.subs.add(sub)
        }

        notify() {
          this.subs.forEach(sub => sub())
        }
      }

      function sub1() {
        log('sub1 update')
      }
      function sub2() {
        log('sub2 update')
      }

      const dep = new Dep()
      dep.addSub(sub1)
      dep.addSub(sub2)

      const observable = obj => new Proxy(obj, { set })

      function set(target, key, value, receiver) {
        const result = Reflect.set(target, key, value, receiver)
        dep.notify()
        return result
      }

      const person = observable({
        name: 'pipilei',
        age: 23
      })

      person.age = 20
    }());

    // Iterator
    ;(function () {  
      function makeIterator(array) {
        const len = array.length
        let nextIndex = 0
        return {
          next() {
            return nextIndex < len
              ? { value: array[nextIndex++], done: false }
              : { value: undefined, done: true }
          }
        }
      }

      const it = makeIterator(['a', 'b'])
      log(it.next())
      log(it.next())
      log(it.next())

      const obj = {
        a: 1,
        b: 2,
        c: 3
      }

      function* entries(obj) {
        for (let key of Object.keys(obj)) {
          yield [key, obj[key]]
        }
      }

      for (let [k, v] of entries(obj)) {
        log(k + ' -> ' + v)
      }
    }())
    
    


  </script>
</body>
</html>